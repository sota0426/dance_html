<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒŸ ã‚ˆã†ã¡ãˆã‚“ã‚¯ã‚¤ã‚ºãŸã„ã‹ã„ ğŸŒŸ</title>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Arial', 'Hiragino Sans', 'Yu Gothic', sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        /* ä¸­å¤®å¯„ã›ã‚’ã‚„ã‚ã¦ã€ç”»é¢å…¨ä½“ã‚’ä½¿ã„ã‚„ã™ã */
        justify-content: flex-start; 
        align-items: flex-start;
        padding: 40px; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’å¢—ã‚„ã™ */
    }

    #app {
        background: white;
        border-radius: 30px;
        padding: 10px;
        /* æœ€å¤§å¹…ã‚’å¤§ããã™ã‚‹ */
        max-width: 1400px; 
        width: 100%;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        margin: auto; /* ä¸­å¤®ã«é…ç½® */
    }

    .screen {
        text-align: center;
    }

    .hidden {
        display: none !important;
    }

    h1 {
        font-size: 3em; /* H1ã‚’å¤§ãã */
        color: #ff6b9d;
        margin-bottom: 25px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    }

    h2 {
        font-size: 2em; /* H2ã‚’å¤§ãã */
        color: #333;
        margin: 30px 0;
    }

    p {
        font-size: 1.4em; /* Pã‚’å¤§ãã */
        color: #555;
        margin: 20px 0;
        line-height: 1.6;
    }

    .cute-button {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        border: none;
        padding: 20px 50px; /* ãƒœã‚¿ãƒ³ã‚’å¤§ãã */
        font-size: 1.6em;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 8px 20px rgba(245, 87, 108, 0.4);
        font-weight: bold;
    }

    .cute-button:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 25px rgba(245, 87, 108, 0.5);
    }

    .cute-button:active {
        transform: translateY(-1px);
    }

#header {
    display: flex;
    justify-content: space-between;
    align-items: center;

    font-size: 1.6em;
    font-weight: bold;
}

    #options-container {
        display: flex;
        flex-direction: column;
        gap: 20px; /* é–“éš”ã‚’åºƒã’ã‚‹ */
        margin-top: 10px;
    }

    .option-button {
        background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        border: 3px solid #ff6b9d;
        padding: 25px; /* ãƒœã‚¿ãƒ³ã‚’å¤§ãã */
        font-size: 1.8em;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s;
        font-weight: bold;
        color: #333;
    }

    .option-button:hover:not(:disabled) {
        transform: scale(1.03); /* ãƒ›ãƒãƒ¼æ™‚ã®æ‹¡å¤§ç‡ã‚’å°‘ã—ä¸‹ã’ã‚‹ */
        box-shadow: 0 8px 20px rgba(255, 107, 157, 0.3);
    }

    .option-button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    .image-options-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 40px; /* é–“éš”ã‚’ã•ã‚‰ã«åºƒã’ã‚‹ */
        margin-top: 40px;
    }

    .image-option {
        background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        border: 4px solid #ff6b9d;
        padding: 20px; 
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s;
        height: 500px; /* é«˜ã•ã‚’å¤§å¹…ã«å¢—ã‚„ã™ */
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    .image-option:hover:not(.disabled) {
        transform: scale(1.03);
        box-shadow: 0 10px 25px rgba(255, 107, 157, 0.4);
    }

    .image-option.disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    .image-option-emoji {
        max-width: 100%; /* ç”»åƒã‚’ã•ã‚‰ã«å¤§ãã */
        height: 400px; /* é«˜ã•ã‚’å¤§å¹…ã«å¢—ã‚„ã™ */
        object-fit: contain;
        margin-bottom: 20px;
        border-radius: 15px;
    }

    .image-option-text {
        font-size: 2.2em; /* ãƒ†ã‚­ã‚¹ãƒˆã‚’ã•ã‚‰ã«å¤§ãã */
        font-weight: bold;
        color: #333;
    }

    #audio-play-button {
        background: linear-gradient(135deg, #ff6b9d 0%, #c471ed 100%);
        color: white;
        border: none;
        padding: 10px 20px; /* ãƒœã‚¿ãƒ³ã‚’å¤§ãã */
        font-size: 1.8em; /* ã‚¢ã‚¤ã‚³ãƒ³ã‚’å¤§ãã */
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 8px 20px rgba(255, 107, 157, 0.4);
    }

    #audio-play-button:hover {
        transform: scale(1.05); /* ãƒ›ãƒãƒ¼æ™‚ã®æ‹¡å¤§ç‡ã‚’èª¿æ•´ */
    }

    /* audio-hint ã¯ä½¿ç”¨ã—ãªã„ãŸã‚éè¡¨ç¤º */
    #audio-hint {
        display: none !important; 
    }

    #feedback-popup {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }

    #popup-content {
        background: white;
        padding: 50px; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’å¤§ãã */
        border-radius: 30px;
        text-align: center;
        max-width: 500px; /* ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’å¤§ãã */
        animation: popup 0.3s ease-out;
    }

    @keyframes popup {
        from {
            transform: scale(0.7);
            opacity: 0;
        }
        to {
            transform: scale(1);
            opacity: 1;
        }
    }

    #popup-message {
        font-size: 2.5em; /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å¤§ãã */
        margin-bottom: 25px;
        color: #ff6b9d;
    }

    #correct-answer-text {
        font-size: 1.5em; /* ãƒ†ã‚­ã‚¹ãƒˆã‚’å¤§ãã */
        color: #666;
        margin-bottom: 30px;
    }

    #final-score-text {
        font-size: 1.8em; /* ãƒ†ã‚­ã‚¹ãƒˆã‚’å¤§ãã */
        line-height: 1.8;
        margin: 30px 0;
    }

    /*
     * æ—¢å­˜ã® .image-options-container ã‚„ .image-option ã®ã‚µã‚¤ã‚ºå¤‰æ›´ã«å€£ã„ã€
     * å‹•ç”»ã‚³ãƒ³ãƒ†ãƒŠã®é«˜ã•ã¨å‹•ç”»è¦ç´ è‡ªä½“ã®é«˜ã•ã‚’å¤§å¹…ã«å¢—ã‚„ã—ã¾ã™ã€‚
     * ã“ã‚Œã«ã‚ˆã‚Šã€ä»–ã®ç”»åƒã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨åŒæ§˜ã«ç”»é¢ã‚’åºƒãä½¿ãˆã¾ã™ã€‚
     */
    #quiz-screen #video-container {
        /* é«˜ã•ã‚’èª¿æ•´ã—ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ä¸­å¤®ã«ä¿ã¤ãŸã‚ */
        padding: 40px; 
    }

    #quiz-screen #quiz-video {
        /* å‹•ç”»ã®é«˜ã•ã‚’å¤§å¹…ã«å¢—ã‚„ã—ã¦ã€ä»–ã®ç”»åƒã‚ªãƒ—ã‚·ãƒ§ãƒ³(500px)ã«è¿‘ã¥ã‘ã‚‹ */
        max-height: 80vh; /* ç”»é¢ã®é«˜ã•ã«å¯¾ã™ã‚‹æ¯”ç‡ã§å¤§ããè¡¨ç¤º */
        height: 600px; /* ã‚ã‚‹ç¨‹åº¦ã®å›ºå®šå€¤ã‚‚è¨­å®š */
        width: 100%; /* å¹…ã¯è¦ªè¦ç´ ã„ã£ã±ã„ã« */
    }

    /* æ—¢å­˜ã® .image-option-emoji ã®é«˜ã•å¤‰æ›´ã¨åˆã‚ã›ã¦ã€ä»–ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¨ã®çµ±ä¸€æ„Ÿã‚’ä¿ã¡ã¾ã™ */
    .image-option-emoji {
        max-width: 100%;
        height: 400px; /* å…ƒã®CSSã‚’ç¶­æŒ */
        object-fit: contain;
        margin-bottom: 20px;
        border-radius: 15px;
    }

</style>
</head>
<body>
<div id="app">
        <div id="start-screen" class="screen">
            <h1>ã‚ˆã†ã¡ãˆã‚“ ã‚¯ã‚¤ã‚ºãŸã„ã‹ã„ï¼</h1>
            <p>ãœã‚“ã¶ã§ï¼‘ï¼ã‚‚ã‚“ã‚ã‚‹ã‚ˆï¼ãŒã‚“ã°ã£ã¦ã­ï¼</p>
            <button id="start-button" class="cute-button">âœ¨ ã‚¯ã‚¤ã‚ºã‚’ã¯ã˜ã‚ã‚‹ âœ¨</button>
        </div>

        <div id="quiz-screen" class="screen hidden">
            <div id="header">
                <span id="question-number">ã‚‚ã‚“ã ã„ 1 / 5</span>
            </div>
            
            <h2 id="question-text">ã“ã“ã«å•é¡ŒãŒã¯ã„ã‚Šã¾ã™</h2>
            
            <div id="quiz-content">
                <div id="video-container" class="hidden" style="margin: 20px 0; padding: 20px; background: #fff3e0; border-radius: 20px; border: 3px solid #ff6b9d;">
                    <video id="quiz-video" controls style="width: 100%; max-height: 600px; border-radius: 15px; margin-bottom: 20px;"></video>
                    <p id="video-description" style="font-size: 1.5em; color: #666;"></p>
                </div>
            </div>
        </div>

<div id="result-screen" class="screen hidden">
            <h1>ğŸŒ¸ ãŠã—ã¾ã„ï¼ ğŸŒ¸</h1>
            <p id="final-score-text"></p>
            <p class="cute-button" style="cursor: default;">ã‚ãã‚“ã§ãã‚Œã¦ ã‚ã‚ŠãŒã¨ã†ï¼</p>
        </div>
    </div>
    
    <div id="feedback-popup" class="hidden">
        <div id="popup-content">
            <h2 id="popup-message"></h2>
            <p id="correct-answer-text"></p>
            <button id="next-button" class="cute-button">ã¤ãã¸</button>
        </div>
    </div>
</div>

<script>
    // å•é¡Œãƒ‡ãƒ¼ã‚¿ï¼ˆ3ç¨®é¡ã®ç”»é¢ã‚¿ã‚¤ãƒ—ï¼‰
    // NOTE: 'audioSrc'ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã¯ã€å®Ÿéš›ã«MP3ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
    const quizData = [
        {
            id: null,
            type: 'image',
            question: "ã™ã™ã‚“ã§ã„ã„ã®ã¯ã©ã£ã¡ï¼Ÿ",
            options: [
                {  text:"ã‚ã‹ã„ã‚", image: "assets/image/singou/aka.png" },
                {  text:"ã‚ãŠã„ã‚",image: "assets/image/singou/ao.png" }
            ],
            answer: "ã‚ãŠã„ã‚",
        },
          {
            id: null,
            type: 'image',
            question: "æ°´æ—é¤¨ã§ã¿ãŸã‚¯ãƒ©ã‚²ã¯ã©ã£ã¡ï¼Ÿ",
            options: [
                {  text:"ï¼‘ã°ã‚“", image: "assets/image/kurage/isogintyaku.jpg" },
                {  text:"ï¼’ã°ã‚“",image: "assets/image/kurage/kurage.jpeg" }
            ],
            answer: "ï¼’ã°ã‚“",
        },      
        {
            id: null,
            type: 'image',
            question: "ã™ã¿ã£ã“ãã‚‰ã—ã€€ã­ã“ã¡ã‚ƒã‚“ã®ã‚ã„ã¼ã†ã¯ï¼Ÿ",
            options: [
                {  text:"ãˆã³ã®ã—ã£ã½", image: "assets/image/sumikko/ebi.png" },
                {  text:"ã–ã£ãã†",image: "assets/image/sumikko/kusa.png" }
            ],
            answer: "ã–ã£ãã†",
        },
        {
            id: null,
            type: 'audio', 
            question: "ã“ã®å‹•ç‰©ã®ãªãã”ãˆã¯ã©ã£ã¡ï¼Ÿ",
            audioSrc: "assets/audio/animal.mp3", // â˜… é³´ãå£°MP3ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ (è¦è¨­ç½®)
            options: [
                {  text:"ã‚‰ã„ãŠã‚“", image: "assets/image/animal/lion.jpeg" }, // ç”»åƒé¸æŠå¼ã®ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå•é¡Œ
                {  text:"ãã†", image: "assets/image/animal/zou.jpeg" }
            ],
            answer: "ãã†",
        },
        {
            id: null,
            type: 'image',
            question: "ã‚¢ãƒ³ãƒ‘ãƒ³ãƒãƒ³ã®ãªã‹ã¿ã¯ã©ã£ã¡ï¼Ÿ",
            options: [
                {  text:"ã“ã—ã‚ã‚“", image: "assets/image/anpan/kosi.jpg" },
                {  text:"ã¤ã¶ã‚ã‚“",image: "assets/image/anpan/tubu.jpg" }
            ],
            answer: "ã¤ã¶ã‚ã‚“",
        },
        {
            id: null,
            type: 'image',
            question: "ãƒ”ã‚«ãƒãƒ¥ã‚¦ã¯ã©ã£ã¡ï¼Ÿ",
            options: [
                {  text:"ï¼‘ã°ã‚“", image: "assets/image/pokemon/mimi.png" },
                {  text:"ï¼’ã°ã‚“",image: "assets/image/pokemon/pika.png" }
            ],
            answer: "ï¼’ã°ã‚“",
        },
        {
            id: null,
            type: 'image',
            question: "ãƒŸãƒƒã‚­ãƒ¼ã®å½¼å¥³ã¯ã©ã£ã¡ï¼Ÿ",
            // NOTE: ä»®ã®ç”»åƒãƒ‘ã‚¹ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚å®Ÿéš›ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¿…è¦ã§ã™ã€‚
            options: [
                {  text:"ï¼‘ã°ã‚“", image: "assets/image/minny/sensei.jpg" },
                {  text:"ï¼’ã°ã‚“",image: "assets/image/minny/minny.png" }
            ],
            answer: "ï¼’ã°ã‚“",
        },
        {
            id: null,
            type: 'image',
            question: "åœ’é•·å…ˆç”Ÿã¯ã©ã£ã¡ã‹ãªï¼Ÿ",
            // NOTE: ä»®ã®ç”»åƒãƒ‘ã‚¹ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚å®Ÿéš›ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¿…è¦ã§ã™ã€‚
            options: [
                {  text:"ï¼‘ã°ã‚“", image: "assets/image/entyou/asi.png" },
                {  text:"ï¼’ã°ã‚“",image: "assets/image/entyou/entyou.jpg" }
            ],
            answer: "ï¼’ã°ã‚“",
        },        
        {
            id: null,
            type: 'image',
            question: "ã¿ã‚ƒãã¿ã‚ƒãã•ã‚“ã¯ã€ã©ã¡ã‚‰ã§ã—ã‚‡ã†ï¼Ÿ",
            // NOTE: ä»®ã®ç”»åƒãƒ‘ã‚¹ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚å®Ÿéš›ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¿…è¦ã§ã™ã€‚
            options: [
                {  text:"ï¼‘ã°ã‚“", image: "assets/image/myaku/myaku.jpg" },
                {  text:"ï¼’ã°ã‚“", image: "assets/image/myaku/anpan.jpg" }
            ],
            answer: "ï¼‘ã°ã‚“", // ä»®ã®æ­£è§£
            specialFeedback: true // â˜… ç‰¹æ®Šãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’æœ‰åŠ¹ã«ã™ã‚‹ãƒ•ãƒ©ã‚°
        },
        {
            id: null,
            type: 'video', // å‹•ç”»ã‚¿ã‚¤ãƒ—
            question: "ã¿ã‚“ãªã¯ãŠã©ã‚Œã‚‹ã‹ãªï¼Ÿ",
            videoSrc: "assets/movie/short.mp4",
            options: ["ã§ããŸï¼"],
            answer: "ã§ããŸï¼",
        },
        {
            id: null,
            type: 'video', // å‹•ç”»ã‚¿ã‚¤ãƒ—
            question: "ã‚¯ã‚¤ã‚ºã€€ãŒã‚“ã°ã£ãŸã­ï¼ï¼ã€€ãŠã—ã¾ã„ï¼",
            videoSrc: "assets/movie/long.mp4",
            options: ["ã§ããŸï¼"],
            answer: "ã§ããŸï¼",
        },        
    ];



let currentQuestionIndex = 0;
    let score = 0;
    let audioPlayed = false;
    let videoPlayed = false; // â˜… å‹•ç”»å†ç”Ÿãƒ•ãƒ©ã‚°ã‚’è¿½åŠ 
    let currentAudio = null; 
    let currentVideo = null; // â˜… å‹•ç”»è¦ç´ ã‚’ä¿æŒ

    const startScreen = document.getElementById('start-screen');
    const quizScreen = document.getElementById('quiz-screen');
    const resultScreen = document.getElementById('result-screen');
    const startButton = document.getElementById('start-button');
    const restartButton = document.getElementById('restart-button');
    const questionNumberSpan = document.getElementById('question-number');
    const scoreSpan = document.getElementById('score');
    const questionText = document.getElementById('question-text');
    const quizContent = document.getElementById('quiz-content');
    const finalScoreText = document.getElementById('final-score-text');
    const feedbackPopup = document.getElementById('feedback-popup');
    const popupMessage = document.getElementById('popup-message');
    const correctAnswerText = document.getElementById('correct-answer-text');
    const nextButton = document.getElementById('next-button');

    // å‹•ç”»é–¢é€£è¦ç´ 
    const videoContainer = document.getElementById('video-container');
    const quizVideo = document.getElementById('quiz-video');
    const videoDescription = document.getElementById('video-description');


    function renderQuestion() {
        if (currentQuestionIndex >= quizData.length) {
            showResultScreen();
            return;
        }

        // å‰ã®ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚’åœæ­¢
        if (currentAudio) {
            currentAudio.pause();
            currentAudio = null;
        }
        // å‰ã®å‹•ç”»ã‚’åœæ­¢
        if (currentVideo) {
            currentVideo.pause();
            currentVideo.classList.add('hidden'); // å‹•ç”»ã‚³ãƒ³ãƒ†ãƒŠã‚‚éè¡¨ç¤ºã«ã™ã‚‹
            videoContainer.classList.add('hidden');
            currentVideo.src = ""; // ã‚½ãƒ¼ã‚¹ã‚’ã‚¯ãƒªã‚¢ã—ã¦ãƒ¡ãƒ¢ãƒªã‚’è§£æ”¾
            currentVideo = null;
        }


        const currentQuiz = quizData[currentQuestionIndex];
        audioPlayed = false;
        videoPlayed = false; // â˜… å‹•ç”»å†ç”Ÿãƒ•ãƒ©ã‚°ã‚’ãƒªã‚»ãƒƒãƒˆ

        // â˜… å•é¡Œæ•°ã®è¡¨ç¤ºã‚’ä¿®æ­£
        questionNumberSpan.textContent = `ã‚‚ã‚“ã ã„ ${currentQuestionIndex + 1} / ${quizData.length}`;
        questionText.textContent = currentQuiz.question;

        quizContent.innerHTML = ''; // quiz-contentã‚’ã‚¯ãƒªã‚¢ã™ã‚‹å‰ã«video-containerã‚’å†é…ç½®
        quizContent.appendChild(videoContainer); // video-containerã‚’å¸¸ã«quiz-contentå†…ã«ä¿æŒ

        // å„ã‚¿ã‚¤ãƒ—ã«å¿œã˜ã¦ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        if (currentQuiz.type === 'text') {
            renderTextOptions(currentQuiz);
        } else if (currentQuiz.type === 'image') {
            renderImageOptions(currentQuiz);
        } else if (currentQuiz.type === 'audio') {
            renderAudioOptions(currentQuiz);
        } else if (currentQuiz.type === 'video') { // â˜… å‹•ç”»ã‚¿ã‚¤ãƒ—
            renderVideoOptions(currentQuiz);
        }
    }

    function renderTextOptions(quiz) {
        const container = document.createElement('div');
        container.id = 'options-container';
        
        quiz.options.forEach(option => {
            const button = document.createElement('button');
            button.textContent = option;
            button.className = 'option-button';
            // â˜… specialFeedbackã‚’è¿½åŠ 
            button.addEventListener('click', () => handleAnswer(option, quiz.answer, quiz.specialFeedback)); 
            container.appendChild(button);
        });
        
        quizContent.appendChild(container);
    }

    function renderImageOptions(quiz) {
        const container = document.createElement('div');
        container.className = 'image-options-container';
        
        quiz.options.forEach(option => {
            const div = document.createElement('div');
            div.className = 'image-option';
            
            const img = document.createElement('img');
            img.src = option.image.startsWith('assets/') ? 
                      option.image : 
                      'https://via.placeholder.com/200/AAAAAA/FFFFFF?text=NO+IMAGE'; 
            img.alt = option.text;
            img.className = 'image-option-emoji';
            
            const textDiv = document.createElement('div');
            textDiv.className = 'image-option-text';
            textDiv.textContent = option.text;
            
            div.appendChild(img);
            div.appendChild(textDiv);
            
            div.addEventListener('click', () => {
                if (!div.classList.contains('disabled')) {
                    // â˜… specialFeedbackã‚’è¿½åŠ 
                    handleAnswer(option.text, quiz.answer, quiz.specialFeedback);
                }
            });
            container.appendChild(div);
        });
        
        quizContent.appendChild(container);
    }

    function renderAudioOptions(quiz) {
        const audioWrapper = document.createElement('div');
        audioWrapper.id = 'audio-wrapper';
        audioWrapper.style.textAlign = 'center';
        
        const audioContainer = document.createElement('div');
        audioContainer.id = 'audio-container';
        // HTMLã®optionsãŒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹æ–‡å­—åˆ—ã‹ã§è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
        const isImageOptions = quiz.options && typeof quiz.options[0] === 'object'; 

        audioContainer.innerHTML = `
            <p style="font-size: 1.5em;">${quiz.audioDescription || ''}</p>
            <button id="audio-play-button">â–¶ï¸ ãŠã¨ã‚’ ãã</button>
            <div id="audio-hint" style="display: none;"></div>
        `;
        
        const playButton = audioContainer.querySelector('#audio-play-button');
        
        // currentAudioã®åˆæœŸåŒ–
        currentAudio = new Audio(quiz.audioSrc);

        playButton.addEventListener('click', () => {
            currentAudio.currentTime = 0;
            currentAudio.play().then(() => {
                playButton.textContent = 'ğŸ”Š ã‚‚ã†ã„ã¡ã© ãã';
                audioPlayed = true;
            }).catch(error => {
                alert('ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ï¼ˆassets/audio/dog_bark.mp3ï¼‰ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                console.error("Audio playback error:", error);
            });
        });
        
        audioWrapper.appendChild(audioContainer);
        quizContent.appendChild(audioWrapper);


        // ç”»åƒé¸æŠè‚¢ã®æç”»ï¼ˆã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå•é¡Œç”¨ï¼‰
        if (isImageOptions) {
            const container = document.createElement('div');
            container.className = 'image-options-container';
            
            quiz.options.forEach(option => {
                const div = document.createElement('div');
                div.className = 'image-option';
                
                const img = document.createElement('img');
                img.src = option.image.startsWith('assets/') ? 
                          option.image : 
                          'https://via.placeholder.com/200/AAAAAA/FFFFFF?text=NO+IMAGE'; 
                img.alt = option.text;
                img.className = 'image-option-emoji';
                
                const textDiv = document.createElement('div');
                textDiv.className = 'image-option-text';
                textDiv.textContent = option.text;
                
                div.appendChild(img);
                div.appendChild(textDiv);
                
                div.addEventListener('click', () => {
                    if (!div.classList.contains('disabled')) {
                        // â˜… specialFeedbackã‚’è¿½åŠ  (ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå•é¡Œã§ã¯é€šå¸¸false)
                        handleAnswer(option.text, quiz.answer, quiz.specialFeedback);
                    }
                });
                container.appendChild(div);
            });
            
            quizContent.appendChild(container);
        } else {
             // ãƒ†ã‚­ã‚¹ãƒˆé¸æŠè‚¢ã®æç”»ï¼ˆå¾“æ¥ã®ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå•é¡Œç”¨ï¼‰
            const optionsContainer = document.createElement('div');
            optionsContainer.id = 'options-container';
            
            quiz.options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.className = 'option-button';
                button.addEventListener('click', () => {
                    handleAnswer(option, quiz.answer, quiz.specialFeedback);
                });
                optionsContainer.appendChild(button);
            });
            
            quizContent.appendChild(optionsContainer);
        }
    }

    // â˜… å‹•ç”»å•é¡Œã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹é–¢æ•°
    function renderVideoOptions(quiz) {
        videoContainer.classList.remove('hidden'); // å‹•ç”»ã‚³ãƒ³ãƒ†ãƒŠã‚’è¡¨ç¤º
        quizVideo.classList.remove("hidden")
        currentVideo = quizVideo; // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ç¾åœ¨ã®å‹•ç”»è¦ç´ ã‚’è¨­å®š
        currentVideo.src = quiz.videoSrc; // å‹•ç”»ã‚½ãƒ¼ã‚¹ã‚’è¨­å®š
        videoDescription.textContent = quiz.videoDescription; // èª¬æ˜ã‚’è¨­å®š

        // å‹•ç”»ãŒå†ç”Ÿã•ã‚ŒãŸã¨ãã«ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹
        currentVideo.onplay = () => {
            videoPlayed = true;
        };

        const optionsContainer = document.createElement('div');
        optionsContainer.id = 'options-container';
        
        quiz.options.forEach(option => {
            const button = document.createElement('button');
            button.textContent = option;
            button.className = 'option-button';
            button.addEventListener('click', () => {
                // å‹•ç”»ã‚’å†ç”Ÿã—ã¦ã„ãªãã¦ã‚‚è§£ç­”ã¯ã§ãã‚‹ã‚ˆã†ã«å¤‰æ›´
                // â˜… specialFeedbackã‚’è¿½åŠ 
                handleAnswer(option, quiz.answer, quiz.specialFeedback);
            });
            optionsContainer.appendChild(button);
        });
        
        quizContent.appendChild(optionsContainer);
    }




    
    // â˜… specialFeedback ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ 
    function handleAnswer(selectedOption, correctAnswer, specialFeedback = false) {
        const isCorrect = selectedOption.includes(correctAnswer) || 
                         selectedOption === correctAnswer;
        
        // éŸ³å£°å•é¡Œã‚’è§£ç­”ã—ãŸã¨ãã«ã€å†ç”Ÿä¸­ã®éŸ³å£°ãŒã‚ã‚Œã°åœæ­¢ã™ã‚‹
        if (currentAudio) {
            currentAudio.pause();
            currentAudio = null;
        }
        // å‹•ç”»å•é¡Œã‚’è§£ç­”ã—ãŸã¨ãã«ã€å†ç”Ÿä¸­ã®å‹•ç”»ãŒã‚ã‚Œã°åœæ­¢ã™ã‚‹
        if (currentVideo) {
            currentVideo.pause();
            currentVideo.classList.add('hidden');
            videoContainer.classList.add('hidden');
            currentVideo.src = ""; // ã‚½ãƒ¼ã‚¹ã‚’ã‚¯ãƒªã‚¢
            currentVideo = null;
        }

        document.querySelectorAll('.option-button').forEach(button => {
            button.disabled = true;
        });
        
        document.querySelectorAll('.image-option').forEach(div => {
            div.classList.add('disabled');
        });
        
        const playButton = document.getElementById('audio-play-button');
        if (playButton) {
            playButton.disabled = true;
        }

        // â˜… ç‰¹æ®Šãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®å‡¦ç†
        if (specialFeedback) {
            popupMessage.textContent = "ã›ã„ã‹ã„ã¯ãƒ»ãƒ»ãƒ»âœ¨";
            correctAnswerText.textContent = ""; // æ­£è§£ãƒ»ä¸æ­£è§£ã‚’è¡¨ç¤ºã—ãªã„
            // ã“ã®å•é¡Œã¯ã‚¹ã‚³ã‚¢ã«åŠ ç®—ã—ãªã„ã¨ã„ã†ç‰¹æ®Šãªãƒ«ãƒ¼ãƒ«ã®ãŸã‚ã€score++ã¯è¡Œã‚ãªã„
        } else {
            // é€šå¸¸ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
            if (isCorrect) {
                score++;
                popupMessage.textContent = "ã‚„ã£ãŸã­ï¼ã›ã„ã‹ã„ï¼ğŸŒŸ";
                correctAnswerText.textContent = "";
            } else {
                popupMessage.textContent = "â€¦ã¡ãŒã†ã‚ˆï¼ğŸ˜”";
                correctAnswerText.textContent = `ã›ã„ã‹ã„ã¯ã€Œ${correctAnswer}ã€ã ã‚ˆã€‚`;
            }
        }

        feedbackPopup.classList.remove('hidden');
    }

    function moveToNext() {
        feedbackPopup.classList.add('hidden');
        currentQuestionIndex++;
        renderQuestion();
    }

function startQuiz() {
    quizData.sort((a, b) => {
        if (a.id === "test" && b.id !== "test") return -1;
        if (a.id !== "test" && b.id === "test") return 1;
        return 0; // ãã‚Œä»¥å¤–ã¯é †ç•ªç¶­æŒ
    });

    startScreen.classList.add('hidden');
    resultScreen.classList.add('hidden');
    quizScreen.classList.remove('hidden');
    currentQuestionIndex = 0;
    score = 0;
    renderQuestion();
}

function showResultScreen() {
        quizScreen.classList.add('hidden');
        resultScreen.classList.remove('hidden');
        // â˜… å•é¡Œæ•° quizData.length ã«åˆã‚ã›ã‚‹
        finalScoreText.innerHTML = `ãœã‚“ã¶ã§ <strong>${quizData.length}ã‚‚ã‚“</strong> ã®ã†ã¡ã€<br><strong>${quizData.length}ã“</strong> ã›ã„ã‹ã„ã—ãŸã‚ˆï¼<br><br>ã™ã”ã„ã­ï¼âœ¨`;
    }

    startButton.addEventListener('click', startQuiz);
    
    nextButton.addEventListener('click', moveToNext);

    document.addEventListener('DOMContentLoaded', () => {
        startScreen.classList.remove('hidden');
        quizScreen.classList.add('hidden');
        resultScreen.classList.add('hidden');
        feedbackPopup.classList.add('hidden');

        // quiz-contentã«video-containerã‚’åˆæœŸçŠ¶æ…‹ã§é…ç½®ã—ã¦ãŠã
        // ã“ã‚Œã«ã‚ˆã‚Šã€quizContent.innerHTML = ''; ã§æ¶ˆå»ã•ã‚Œãšã«æ¸ˆã‚€
        document.getElementById('quiz-content').appendChild(videoContainer);
        videoContainer.classList.add('hidden'); // æœ€åˆã¯éè¡¨ç¤º
    });
</script>


</body>
</html>